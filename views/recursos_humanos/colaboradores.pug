extends ../layout 

block contenido
  .content-wrapper
    .content-header
      .container-fluid
        .row.mb-2
          .col-sm-6
            h1.m-0 Colaboradores
          .col-sm-6.text-right
            button.btn.btn-success(data-toggle="modal" data-target="#addTrabajadorModal") 
              i.fas.fa-plus
              |  Nuevo
        // /.row
      // /.container-fluid
    // /.content-header
    // Main content
    section.content
      .container-fluid
        table#trabajadoresTable.table.table-striped
          thead
            tr
              th Nombre
              th Apellido
              th.d-none.d-sm-table-cell Cargo
              th.d-none.d-sm-table-cell Estado
              th 
          tbody
            each trabajador, index in trabajadores
              tr
                td= trabajador.nombre
                td= trabajador.apellido
                th.d-none.d-sm-table-cell= trabajador.cargo
                th.d-none.d-sm-table-cell= trabajador.estado
                td
                  button.btn.btn-primary.btn-sm.mx-2(data-toggle="modal" data-target=`#detalleTrabajadorModal${index}`) 
                    i.fas.fa-eye

                  // Modal de Detalles del Trabajador
                  .modal.fade(id=`detalleTrabajadorModal${index}` tabindex="-1" role="dialog")
                    .modal-dialog.modal-xl(role="document")
                      .modal-content
                        .modal-header
                          h5.modal-title Detalles de Trabajador - #{trabajador.nombre} #{trabajador.apellido}
                          button.close(type="button" data-dismiss="modal" aria-label="Close")
                            span(aria-hidden="true") &times;
                        .modal-body
                          // Información Personal
                          h5 Información Personal
                          p Dirección: #{trabajador.direccion}
                          p RUT: #{trabajador.rut}
                          p Estado Civil: #{trabajador.estado_civil}
                          p Cuenta Bancaria: #{trabajador.cuenta_bancaria}
                          p Contacto de Emergencia: #{trabajador.contacto_emergencia}

                          hr

                          // Datos Laborales
                          h5 Datos Laborales
                          p Sueldo: $#{trabajador.sueldo}
                          p Fecha de Ingreso: #{trabajador.fecha_ingreso ? trabajador.fecha_ingreso.toLocaleDateString('es-ES') : 'Fecha no disponible'}
                          p Tipo de Contrato: #{trabajador.tipo_contrato}

                          hr

                          // Lista de Pagos
                          h5 Lista de Pagos
                          table.table.table-bordered.mt-2
                            thead
                              tr
                                th Fecha
                                th Monto
                            tbody
                              each pago in trabajador.pagos_colaboradores
                                tr
                                  td= pago.fecha.toLocaleDateString('es-ES')
                                  td= `$${pago.monto}`

                          hr

                          // Lista de Liquidaciones
                          h5 Lista de Liquidaciones
                          table.table.table-bordered.mt-2
                            thead
                              tr
                                th Fecha
                                th Detalle
                            tbody
                              each liquidacion in trabajador.liquidaciones
                                tr
                                  td= liquidacion.fecha.toLocaleDateString('es-ES')
                                  td= liquidacion.detalle

                          hr

                          // Documentos
                          h5 Documentos
                          table.table.table-bordered.mt-2
                            thead
                              tr
                                th Tipo
                                th Descripción
                                th Archivo
                            tbody
                              each documento in trabajador.documentos
                                tr
                                  td= documento.tipo
                                  td= documento.descripcion
                                  td
                                    a(href=`/descargar/${documento.archivo}`) Descargar

                        .modal-footer
                          button.btn.btn-secondary(type="button" data-dismiss="modal") Cerrar

      // Modal para Agregar Nuevo Trabajador
      .modal.fade#addTrabajadorModal(tabindex="-1" role="dialog")
        .modal-dialog.modal-lg(role="document")
          .modal-content
            .modal-header
              h5.modal-title Nuevo Trabajador
              button.close(type="button" data-dismiss="modal" aria-label="Close")
                span(aria-hidden="true") &times;
            .modal-body
              form(action="/recursosHumanos/agregar" method="POST")
                input(type="hidden" name="_csrf" value=csrfToken) 
                .form-group
                  label(for="nombre") Nombre
                  input#nombre.form-control(type="text" name="nombre" required)
                .form-group
                  label(for="apellido") Apellido
                  input#apellido.form-control(type="text" name="apellido" required)
                .form-group
                  label(for="cargo") Cargo
                  input#cargo.form-control(type="text" name="cargo" required)
                .form-group
                  label(for="estado") Estado
                  select#estado.form-control(name="estado" required)
                    option(value="activo") Activo
                    option(value="inactivo") Inactivo
                // Campos adicionales
                .form-group
                  label(for="direccion") Dirección
                  input#direccion.form-control(type="text" name="direccion")
                .form-group
                  label(for="rut") RUT
                  input#rut.form-control(type="text" name="rut")
                .form-group
                  label(for="estado_civil") Estado Civil
                  input#estado_civil.form-control(type="text" name="estado_civil")
                .form-group
                  label(for="cuenta_bancaria") Cuenta Bancaria
                  input#cuenta_bancaria.form-control(type="text" name="cuenta_bancaria")
                .form-group
                  label(for="contacto_emergencia") Contacto de Emergencia
                  input#contacto_emergencia.form-control(type="text" name="contacto_emergencia")
                .form-group
                  label(for="sueldo") Sueldo
                  input#sueldo.form-control(type="number" step="0.01" name="sueldo")
                .form-group
                  label(for="fecha_ingreso") Fecha de Ingreso
                  input#fecha_ingreso.form-control(type="date" name="fecha_ingreso")
                .form-group
                  label(for="tipo_contrato") Tipo de Contrato
                  input#tipo_contrato.form-control(type="text" name="tipo_contrato")
                button.btn.btn-primary(type="submit") Guardar
            .modal-footer
              button.btn.btn-secondary(type="button" data-dismiss="modal") Cerrar


      // Scripts para DataTables y Bootstrap
      script(src="https://code.jquery.com/jquery-3.3.1.min.js")
      script(src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js")
      script(src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js")
      script(src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js")
      script.
        new DataTable('#trabajadoresTable',{
          "language": {
            "url": "https://cdn.datatables.net/plug-ins/1.11.5/i18n/es-ES.json",
          }
        })
